syntax enable
filetype plugin on
filetype indent on
colorscheme default
let mapleader = "`"
let maplocalleader = "`"

set guioptions-=m
set guioptions-=T
set scrolloff=100
set tabstop=4
set nobackup
set shiftwidth=4
set noshowmatch
set showcmd
set autowrite
set foldmethod=marker
set foldcolumn=0
set backspace=indent,eol,start
set incsearch
set ignorecase
set formatoptions+=ro
set cinoptions+=g0,(4
set nohlsearch
set guifont=Terminus\ 13
set mouse=nir
set laststatus=2
set statusline=%<%f\ %h%m%r%=%-14.(%l,%c%V%)\ %P
set tags=tags;
set encoding=utf-8
set fileencodings=utf8,cp1251
set t_Co=256
set modeline
set textwidth=80

au Bufenter * syntax sync minlines=50

au FileType *haskell set expandtab 
au FileType cabal set expandtab

" Enable auto-paragraph-reformat, when editing emails
au FileType mail set fo+=an

" When editing a file, always jump to the last known cursor position.
" Don't do it when the position is invalid or when inside an event handler
" (happens when dropping a file on gvim).
au BufReadPost *
	\ if line("'\"") > 0 && line("'\"") <= line("$") |
	\   exe "normal g`\"" |
	\ endif

" General bindings
nnoremap <F2> <ESC>:w<CR>
inoremap <F2> <ESC>:w<CR>
inoremap <Leader><Leader> <Leader>

" Fast command line
nnoremap ! :!

" Display lines scrolling
nnoremap j gj
nnoremap k gk
nnoremap Y y$

" Quick quit
nnoremap <ESC><ESC> <ESC>:qa<CR>
nnoremap q <ESC>:qa<CR>

" Visual mode tweaks
vnoremap : y:<C-r>"<C-b>
vnoremap ! y:!<C-r>"<C-b><Right>

" Easy paste
nnoremap <Leader>i :set paste<CR>i
nnoremap i :set nopaste<CR>i

" Open quickfix window
nnoremap <Leader>f :cope<CR>

" make
nnoremap <F5> :make<CR>
inoremap <F5> <Esc>:make<CR>

" Quicfix bindings {{{
function! QFmap(a,b)
	exe "au BufWinEnter quickfix map <buffer> " . a:a . " " . a:b
endfunction
command! -nargs=+ QFmap :call QFmap(<f-args>)

QFmap o <cr>
QFmap J :cnext<cr>:copen<cr>
QFmap K :cprevious<cr>:copen<cr>
QFmap <C-o> :cold<cr>
QFmap <C-i> :cnew<cr>
QFmap <Leader>f <C-w>q
QFmap q :q<cr>
" }}}

" Clipboard bindings {{{
if has("x11")
	vnoremap y "+y
	vnoremap d "+d
	vnoremap c "+c
	vnoremap p "+p
	nnoremap Y "+y$
	nnoremap yy "+yy
	nnoremap yw "+yw
	nnoremap p "+p
	nnoremap P "+P
endif
" }}}

" Russian layout bindings {{{
function! KBmap(a,b)
	exe "map " . a:a . " " . a:b
	exe "cmap " . a:a . " " . a:b
endfunction
command! -nargs=+ KBmap :call KBmap(<f-args>)

KBmap —ë `
KBmap –π q
KBmap —Ü w
KBmap —É e
KBmap –∫ r
KBmap –µ t
KBmap –Ω y
map –Ω–Ω yy
KBmap –≥ u
KBmap —à i
KBmap —â o
KBmap –∑ p
KBmap —Ö [
KBmap —ä ]
KBmap —Ñ a
KBmap —ã s
KBmap –≤ d
map –≤–≤ dd
KBmap –∞ f
KBmap –ø g
KBmap —Ä h
KBmap –æ j
KBmap –ª k
KBmap –¥ l
KBmap –∂ ;
KBmap —ç '
KBmap —è z
KBmap —á x
KBmap —Å c
KBmap –º v
KBmap –∏ b
KBmap —Ç n
KBmap —å m
KBmap –± ,
KBmap —é .
KBmap –Å ~
KBmap –ô Q
KBmap –¶ W
KBmap –£ E
KBmap –ö R
KBmap –ï T
KBmap –ù Y
KBmap –ì U
KBmap –® I
KBmap –© O
KBmap –ó P
KBmap –• {
KBmap –™ }
KBmap –§ A
KBmap –´ S
KBmap –í D
KBmap –ê F
KBmap –ü G
KBmap –† H
KBmap –û J
KBmap –õ K
KBmap –î L
KBmap –ñ :
KBmap –≠ "
KBmap –Ø Z
KBmap –ß X
KBmap –° C
KBmap –ú V
KBmap –ò B
KBmap –¢ N
KBmap –¨ M
KBmap –ë <
KBmap –Æ >
"}}}

" Readline-style bindings {{{
" Map <A-f>
imap f <C-o>e<C-o>a
cmap f <S-Right>
KBmap –∞ f

" Map <A-b>
imap b <C-o>b
cmap b <S-Left>
KBmap –∏ b

" Map <A-d>
imap d <C-o><C-v>ed
KBmap –≤ d
"}}}

" Find file in current directory and edit it. {{{
function! Find(...)
  let path="."
  if a:0==2
    let path=a:2
  endif
  let l:list=system("find ".path. " -name '".a:1."' | grep -v .svn ")
  let l:num=strlen(substitute(l:list, "[^\n]", "", "g"))
  if l:num < 1
    echo "'".a:1."' not found"
    return
  endif
  if l:num == 1
    exe "open " . substitute(l:list, "\n", "", "g")
  else
    let tmpfile = tempname()
    exe "redir! > " . tmpfile
    silent echon l:list
    redir END
    let old_efm = &efm
    set efm=%f

    if exists(":cgetfile")
        execute "silent! cgetfile " . tmpfile
    else
        execute "silent! cfile " . tmpfile
    endif

    let &efm = old_efm

    " Open the quickfix window below the current window
    botright copen

    call delete(tmpfile)
  endif
endfunction
command! -nargs=* Find :call Find(<f-args>)
" }}}

" TagList
let g:Tlist_Use_Horiz_Window = 1
let g:Tlist_Show_One_File = 1
let g:Tlist_Max_Tag_Length = 30
let g:Tlist_GainFocus_On_ToggleOpen = 1
nnoremap <Leader>l <ESC>:TlistToggle<CR>

" NERDTree settings
let g:NERDTreeWinSize=25
let g:NERDTreeIgnore=['\.o$', '\.ko$', '^cscope', '\.hi']
nnoremap <Leader>n <ESC>:NERDTreeToggle<CR>
inoremap <Leader>n <ESC>:NERDTreeToggle<CR>
nnoremap <Leader>N <ESC>:NERDTreeFind<CR>
inoremap <Leader>N <ESC>:NERDTreeFind<CR>

" BufferExplorer
nnoremap <Leader>e <Esc>:BufExplorer<CR>
inoremap <Leader>e <Esc>:BufExplorer<CR>

" EasyGrep
let g:EasyGrepRecursive = 1
let g:EasyGrepMode = 2

" Haskell
let g:haddock_browser = "firefox"
let g:haddock_browser_callformat = '%s %s'
let g:haskell_indent_case = 0
let g:haskell_indent_if = 0

" Local vimrc
let g:local_vimrc = '.vimrc_local.vim'

" GetLatestVimScripts
let g:GetLatestVimScripts_allowautoinstall = 1

" Comments
map <leader>c <C-C>
map <leader>x <C-X>

" Opener
let g:opener_cmd = "xdg-open"

